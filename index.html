<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
    integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="assets/style/style.css" />
  <title>Work Day Scheduler</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
</head>

<body>
  <header class="jumbotron">
    <h1 class="display-3">Work Day Scheduler</h1>
    <p class="lead">A simple calendar app for scheduling your work day</p>
    <p id="currentDay" class="lead"></p>
  </header>
  <div class="container">
    <!-- Timeblocks created in jQuery will appear here -->
  </div>
  <script>
    // declaring variable to store a function to retrieve today's date
    var currentTime = new Date();
    // declaring a variable defining the current hour
    var currentHour = currentTime.getHours();
    // declaring functions to define months and days, so that the Date displays properly on the page.
    var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

    
    // waiting until html page loads to run jQuery script
    $(document).ready(function () {
      // displaying current time in the currentDay paragraph 
      $("#currentDay").text(days[(new Date()).getDay()] + ", " + months[(new Date()).getMonth()] + " " + new Date().getDate());

      // var myTasks = ["","","","","","","","",""];
      var todo9 = $("#9am").text();
      var todo10 = $("#10am").text();
      var todo11 = $("#11am").text();
      var todo12 = $("#12pm").text();
      var todo1 = $("#1pm").text();
      var todo2 = $("#2pm").text();
      var todo3 = $("#3pm").text();
      var todo4 = $("#4pm").text();
      var todo5 = $("#5pm").text();

      var timeblocks = [
        {
          hour: "9am",
          todo9: $("#9am").text()
        },
        {
          hour: "10am",
          todo10: $("#10am").text()
        },
        {
          hour: "11am",
          todo11: $("#11am").text()
        },
        {
          hour: "12pm",
          todo12: $("#12pm").text()
        },
        {
          hour: "1pm",
          todo1: $("#1pm").text()
        },
        {
          hour: "2pm",
          todo2: $("#2pm").text()
        },
        {
          hour: "3pm",
          todo3: $("#3pm").text()
        },
        {
          hour: "4pm",
          todo4: $("#4pm").text()
        },
        {
          hour: "5pm",
          todo5: $("#5pm").text()
        }
      ];
      
      var container = $(".container");
      var saveBtn = $(".saveBtn");

      allTodos = [todo9, todo10, todo11, todo12, todo1, todo2, todo3, todo4, todo5];
      
      // function to create the planner elements dynamically with jQuery
      function renderTimeblocks() {
        container.empty();
        if (localStorage.getItem("Tasks") !== null) {
        localStorage.getItem("Tasks", JSON.parse(allTodos));
        
        }
        
        for (var i = 0; i < timeblocks.length; i++) {
          // making a div for each set of time block elements 
          var wrap = $("<div>");
          // giving the div a class of wrap and row
          wrap.addClass("wrap");
          wrap.addClass("row");
          wrap.addClass("data-index", timeblocks[i].hour);
          // appending the wrap divs to the larger container div
          container.append(wrap);

          // creating a span for each hour with classes hour, row, and col-1.5
          var s = $("<span>");
          s.addClass("hour");
          s.addClass("row");
          s.addClass("col-1.5");
          // giving span elements the text of the workday hours
          s.text(timeblocks[i].hour);
          // appending to the wrap div
          wrap.prepend(s);

          // creating divs for each timeblock
          var block = $("<div>");

          // adding classes for time-block, row, and col-9 (column 3/4 the width of the screen)
          block.addClass("time-block");
          block.addClass("row");
          block.addClass("col-9");
          // appending time block to corresponding wrap div
          wrap.append(block);

          // current hour will have the class "present", colored red
          if (currentHour === (i + 9)) {
            block.addClass("present");
            // wrap.append(block);
          }
          // hours in the past will have the class "past", colored gray
          if (currentHour > (i + 9)) {
            block.addClass("past");

            // wrap.append(block);
          }
          // hours in the future will have the class "future", colored green
          if (currentHour < (i + 9)) {
            block.addClass("future");
            // wrap.append(block);
          }
          // creating text area for each div, to type tasks into
          var textArea = $("<textarea>");
          textArea.addClass("row")
          textArea.addClass("col-12");
          textArea.attr("id", timeblocks[i].hour);
          textArea.text(allTodos[i]);
          // attaching textareas to their parent div elements
          block.append(textArea);

          // adding buttons for each time block
          var b = $("<button>");
          // assigning the classes saveBtn, row, and col-1 (1/12 width of window)
          b.addClass("saveBtn");
          b.addClass("row");
          b.addClass("col-1.5");
          // assigning each save button a data-index to connect it with corresponding work hour
          b.attr("data-index", timeblocks[i].hour);
          wrap.append(b);
          
          // creating an image tag and assigning it to a variable named saveImg
          var saveImg = $("<img>");
          // adding the class saveImg to the variable saveImg
          saveImg.addClass("saveImg");
          // assigning save icon to the img tag, adding alt text of "Save Icon"
          saveImg.attr("src", "assets/images/save-white.png");
          saveImg.attr("alt", "Save Icon");
          // appending the image to each button 
          b.append(saveImg);

          // creating an image tag and assigning it to a variable named saveImgBlk
          var saveImgBlk = $("<img>");
          saveImgBlk.addClass("saveImgBlk");
          saveImgBlk.attr("src", "assets/images/save-black.png");
          saveImgBlk.attr("alt", "Save Icon Hover");
          // appending the image to each button
          b.append(saveImgBlk);
        }
      }
      // calling render function
      
      // WHEN I click into a time block
      // THEN I can enter an event
      
      // WHEN I click the save button for that time block
      // THEN the text for that event is saved in local storage

      // function saveTasks() {
      //   var index = $(this).attr("data-index");
      //   var whichTask = timeblocks[index];
      //   var newTask = $(whichTask).val()
      //   myTasks[index] = newTask;
      //   localStorage.setItem("Tasks", JSON.stringify(timeblocks));
      // };


      $(".saveBtn").on("click", function(){
        event.stopPropagation();
        console.log(this);
        var index = $(this).attr("data-index");
        var whichTask = allTodos[index];
        var newTask = $(whichTask).val()
        allTodos[index] = newTask;
        localStorage.setItem("Tasks", JSON.stringify(allTodos));
      }); 

      
      renderTimeblocks();
      // {
      //   // logging the button I clicked on
      //   console.log(this);
      //   // making a var

      //   // var clickSave = $(this).attr("data-index");
      //   if ($(this).attr("data-index") === "9am") {
      //     // console.log($("#9am").text());
      //     var task9am = $("#9am").text();

      //     timeblocks[0].tasks.value = ($("#9am").text());
      //     localStorage.setItem("9am Task", JSON.stringify(task9am));
      //   }


      //   // else if ($(this).attr("data-index") === "9am") {
          
      //   // }
      //   // else if ($(this).attr("data-index") === "10am") {
          
      //   // }
      //   // else if ($(this).attr("data-index") === "11am") {
          
      //   // }
      //   // else if ($(this).attr("data-index") === "12pm") {
          
      //   // }
      //   // else if ($(this).attr("data-index") === "1pm") {
          
      //   // }
      //   // else if ($(this).attr("data-index") === "2pm") {
          
      //   // }
      //   // else if ($(this).attr("data-index") === "3pm") {
          
      //   // }
      //   // else if ($(this).attr("data-index") === "4pm") {
          
      //   // }
      //   // else if ($(this).attr("data-index") === "5pm") {
          
      //   // }
      //   // timeblocks.tasks = textArea.textContent;
      //   // next, add to local storage (look at array of objects timeblocks i made above, see if I can use that)
      //   // var userInput = ... not done yet
      //   $("#10am").on("click", function(){
      //     console.log(this);
      //   })
      // });
      
      // WHEN I refresh the page
      // THEN the saved events persist
      // (local storage works properly)
    

    });

    //     if(i === 12){
      //       chosenTag.css(["background-color", "red"]);
      //       chosenTag.addClass("red-class");
      //     }
      //     if((new Date()).getHours() === i){ // uses military time 0-23 for hours
      //       chosenTag.addClass("red-class");
      //     }

      // in textarea associated with $(this)...using 
      // want to us (this) keyword to identify which save button you're clicking
      // that way, you don't need a new click event for each button
  </script>

</body>

</html>